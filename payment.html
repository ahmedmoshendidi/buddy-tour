<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Payment</title>
</head>
<body>
  <h2>Processing Payment...</h2>
  <iframe id="payment-frame" width="100%" height="600" frameborder="0"></iframe>

  <script>
    const iframeUrl = localStorage.getItem("iframe_url");
    const orderId = localStorage.getItem("order_id");

    if (!iframeUrl || !orderId) {
      window.location.href = "/fail.html";
    } else {
      document.getElementById("payment-frame").src = iframeUrl;

      const interval = setInterval(async () => {
        const res = await fetch(`/api/payment-status/${orderId}`);
        const statusData = await res.json();
        if (statusData.status === "success") {
          clearInterval(interval);
          window.location.href = "/success.html";
        } else if (statusData.status === "fail") {
          clearInterval(interval);
          window.location.href = "/fail.html";
        }
      }, 4000);
    }
  </script>
</body>
</html>
